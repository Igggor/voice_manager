# В данной папке живёт голосовой помощник Sreda.

# I. Description
## Функции.
- [ ] Уведомления, таймеры, секундомер, заметки;
- [ ] Сценарии (группировка действий);
- [ ] Перевод текста;
- [ ] Логирование;
- [ ] Прогноз погоды, курс валют;
- [ ] Взаимодействие с web-страницей;
- [ ] (Перспектива) Произвольные запросы в интернет;
- [ ] (Перспектива) Воспроизведение музыки;

## Особенности.
- [ ] Многие функции доступны без подключения к интернету (в перспективе);
- [ ] Скорость работы (в перспективе);
- [ ] Все используемые API - бесплатные или имеющие лимиты, которые при стандартном 
      использовании голосового ассистента недостижимы;

## Поддерживаемые языки.
Это ещё одна особенность данного проекта: создан задел под мультиязычность 
(**полная работоспособность гарантируется только на русском**).

### Полностью поддерживается (без ограничений) ввод и распознавание на языках:
  - ``ru`` - русский (**основной**);
  - ``en`` - английский;
  - ``fr`` - французский;
  - ``es`` - испанский;
  - ``pt`` - португальский;
  - ``de`` - немецкий.

На других языках некоторые функции недоступны.

Вывод (speaking) поддерживается на большем количестве языков (порядка 30).

**Ограничения на ввод связаны с возможностями одной из используемых библиотек.**

# II. For development
Обратите внимание, что тестирование не завершено, поэтому некоторые функции могут работать некорректно.

Все основные настройки хранятся в ``Sreda/settings.py``, также в папке ``Sreda/storage`` должен находиться 
``.env``-файл, его конфигурация описана ниже.

### Установка.
Активируйте ``venv``, а затем установите все необходимые пакеты: ``pip install -r requirements.txt``. При возникновении 
ошибок во время установки зависимостей попробуйте повторить попытку, запустив в терминале
``pip install -r requirements.txt --no-cache-dir``.

### Организация файлов.
Рабочая папка - ``Sreda``.

* ``main.py`` - главный файл, откуда осуществляется запуск приложения.
* ``app.py`` - код приложения.
* ``settings.py`` - настройки приложения.
* ``environment.py`` - работа с переменными окружения.
* В папке ``model`` хранится распознавания речи.
* В папке ``modules`` хранятся части приложения: календарь, работа с речью, текстом, перевод текста, логирование и т.д.
* В папке ``static`` хранятся константы и связанные с ними функции.
* В папке ``storage`` хранятся ``triggers.json`` - триггеры команд, ``.env``-файл и ``buffer`` - буфер с звуковыми файлами.

### Перед запуском:
- Убедитесь, что существует ``.env``-файл в папке ``storage``. Он должен содержать следующие значения:
  * ``MODEL`` - размеры распознающей мультиязыковой модели.
  * ``WEATHER_API_KEY`` - API-ключ сервиса OpenWeather.
  * ``NATIVE_API_KEY`` - API-ключ для взаимодействия с сервером.
  * ``RECOGNITION_API_KEY`` - API-ключ speech-to-text модели.
  * ``SELF_CODE`` - уникальный идентификатор ``Raspberry-PI``.
  * ``DYNAMIC_BUILDING`` - принимает значения ``"True"`` или ``"False"``. 
    Это системный параметр - рекомендуется установить ``"True"``.


- Запустите файл ``setup.py``. 
  * Будут загружены переменные из ``.env``-файла.

  * После появления фразы ``If any triggers need to be rebuilt, please input their keys here... `` в этой же строке 
    запишите через пробел ключи команд (например, ``add-notification weather-now``), для которых были внесены изменения 
    в ``DEFAULT_TRIGGERS`` в файле ``static/constants.py``. Если ничего перестраивать не нужно и вы не вносили изменений 
    в константы ``DEFAULT_TRIGGERS`` (скорее всего так и есть), просто нажмите ``Enter``. Это ничего не сломает.
    Вы также можете написать ``all``, чтобы перестроить всё.

  * Затем будет начато построение мультиязычных триггеров для команд, ключи которых вы ввели в предыдущем пункте, 
    и для всех команд, триггеры для которых не найдены в ``DEFAULT_TRIGGERS``.

  * Также будет построен перевод для слов, указанных вами, а также тех, которые не были найдены в ``AUXILIARY_WORDS``.

    **Обратите внимание**, этот процесс может занять длительное время (на данном этапе - **около полутора часов**). 
    Прогресс будет отображаться в консоли.

  * После завершения этого процесса будет загружена та модель распознавания, которая была указана в ``.env``-файле.

  * Процесс завершён: вы можете запускать приложение - ``main.py``.

  #### Какие ошибки могут возникнуть:
    * ``Cannot load...`` - возникла проблема с загрузкой переменных из окружения, более конкретно проблема определена
      в самом исключении.

    * ``Cannot find the DEFAULT_TRIGGERS for <X> key. You should add it manually.``
      Проверьте, что этот ключ присутствует в ``DEFAULT_TRIGGERS`` в файле ``static/constants.py``.

    * ``Unexpected error while building triggers`` - непредвиденная ошибка при построении триггеров. Такого произойти
      не должно, но если всё-таки случилось - пишите разработчикам.

  #### Когда это всё нужно сделать:
    * Перед **первым** запуском на устройстве.
    * При внесении изменений в ``.env``-файл.
    * При внесении изменений в ``DEFAULT_TRIGGERS`` или ``AUXILIARY_WORDS`` в файле ``static/contants.py``.
    * При добавлении новых функций (это частный случай предыдущего пункта).
    * **Перед сохранением в репозиторий**.

### Запуск приложения:
- Убедитесь, что все изменения, внесенные вами, сохранены, и предварительно был запущен файл ``setup.py``.
- Запустите ``main.py``.
  #### Какие ошибки могут возникнуть:
    * Все те же, что и при запуске в ``setup.py`` (см. выше).

    * ``Triggers/alias are not ready`` - не построены некоторые триггеры и обращение. Возможные причины:
      1. Произошло что-то неожиданное: просто попробуйте запустить ``setup.py`` ещё раз. 
        Если ``setup.py`` сообщает, что всё готово (а при запуске ``main.py`` происходит ошибка), 
        переходите к следующему пункту.
      2. **Наиболее вероятно:** вы добавили новую команду в ``TextProcessor.functions``, но не добавили 
        ``DEFAULT_TRIGGERS`` для неё. 
        Откройте файл ``static/constants.py`` и в переменную ``DEFAULT_TRIGGERS`` добавьте новую команду и триггеры 
        на русском языке  для неё.
      3. Если ничего не помогло, попробуйте при запуске ``setup.py`` полностью перестроить файл триггеров: 
        рядом с выводом ``If any triggers need to be rebuilt, please input their keys here... `` напишите ``all``. 
        Полное перестроение займёт довольно продолжительное время (**около полутора часов!**), но почти наверняка решит проблему.
      4. Вообще всё плохо - пишите разработчикам.

    * ``Auxiliary words are not ready`` - не построены некоторые вспомогательные слова для работы на других языках. 
      Просто запустите ``setup.py`` заново.

    * Какие-то страшные непредвиденные ошибки - пишите разработчикам.

# III. Support
  При возникновении вопросов пишите в Telegram: ``@ii_nikolaev`` и ``@raystelle``.

# IV. Roadmap
  1. Доработка взаимодействия с сайтом.
  2. ...
